### JAVA 内存模型

#### 概念

- 主内存
  java 虚拟机规定所有的变量(不是程序中的变量)都必须在主内存中产生.

- 工作内存
  java 虚拟机中每个线程都有自己的工作内存,该内存是线程私有的.线程的工作内存保存了线程需要的变量在主内存中的副本.JVM规定,线程对主内存变量的修改必须在线程的工作内存中进行,不能直接读写主内存中的变量.不同的线程之间也不能相互访问对方的工作内存.如果线程之间需要传递变量的值,必须通过主内存来作为中介进行传递.
  ![线程,工作内存,主内存之间的交互关系](data:image/png;base64,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)

- 工作内存与主内存交互
  java 内存中线程的工作内存和主内存的交互是由 java 虚拟机定义了如下的8种操作来完成的,每种操作必须是原子性的

  - lock(锁定)
    作用于主内存的变量,一个变量在同一时间只能一个线程锁定,该操作表示这条线程独占这个变量
  - unlock(解锁)
    作用于主内存的变量,表示这个变量的状态由处于锁定状态被释放,这样其他线程才能对该变量进行锁定
  - read(读取)
    作用于主内存变量,表示把一个主内存变量的值传输到线程的工作内存,以便之后的 load 操作使用
  - load(载入)
    作用于线程的工作内存的变量,表示把 read 操作从主内存中读取的变量的值放到工作内存的变量副本中
  - use(使用)
    作用于线程的工作内存中的变量,表示把工作内存中的一个变量的值传递给执行引擎,每当虚拟机遇到一个需要使用变量的值的字节码指令时就会执行该操作
  - assign(赋值)
    作用于线程的工作内存的变量,表示把执行引擎返回的结果赋值给工作内存中的变量,每当虚拟机遇到一个给变量赋值的字节码指令时就会执行该操作
  - store(存储)
    作用于线程的工作内存中的变量,把工作内存中的一个变量的值传递给主内存,以便随后的 write 操作使用
  - write(写入)
    作用于主内存的变量,把 store 操作从工作内存中得到的变量的值放入主内存的变量中

  如果要把一个变量从主内存传输到工作内存.那就要顺序的执行 read 和 load 操作,如果要把一个变量从工作内存写到主内存,就要顺序的执行 store 和 write 操作.对于普通变量,虚拟机只是要求顺序的执行,并没有要求连续的执行,对于这8种操作,虚拟机也规定了一系列规则,在执行这8种操作的时候必须遵循如下的规则

  - 不允许 read 和 load,store 和 write 操作单独出现
  - 不允许一个线程丢弃最近的 assign 操作
  - 不允许一个线程回写没有修改的变量到主内存
  - 变量只能在主内存中产生
  - 一个变量在同一时刻只能被一个线程对其进行 lock 操作
  - 对变量执行 lock 操作,就会清空工作空间该变量的值
  - 不允许对没有 lock 的变量执行 unlock 操作
  - 对一个变量执行 unlock 之前,必须先把变量同步回主内存中

- volatile 修饰的变量的特殊规则
  假定 T 表示一个线程, V 和 W 分别表示两个 volatile 修饰的变量,那么在进行 read,load,use,assign,store 和 write 操作的时候需要满足如下规则:

  - 只有当线程 T 对变量 V 执行的前一个动作是 load,线程 T 对变量 V 才能执行 use 动作;同时只有当线程 T 变量 V 执行的后一个动作是 use 的时候 T 对变量 V 才能执行 load 操作.用于保证线程 T 能看见其他线程对变量 V 的最新修改后的值
  - 只有当线程 T 对变量 V 执行的前一个动作是 assign 的时候,线程 T 对变量 V 才能执行 store 动作;同时只有当线程 T 对变量 V 执行的后一个动作是 store 的时候,线程 T 对变量 V 才能执行 assign 动作.用于保证线程 T 对变量 V 的修改能立刻被其他线程看到
  - 假定动作 A 是线程 T 对变量 V 实施的 use 或 assign 动作,动作 F 是和动作 A 相关联的 load 或 store 动作,动作 P 是和动作 F 相对应的对变量 V 的 read 或 write 动作;类似的,假定动作 B 是线程 T 对变量 W 实施的 use 或 assign 动作,动作 G 是和动作 B 相关联的 load 或 store 动作,动作 Q 是和动作 G 相对应的变量 W 的 read 或 write 动作.如果动作 A 先于 B,那么 P 先于 Q.也就是说在同一个线程内部,被 volatile 修饰的变量不会被指令重排序,保证代码的执行顺序和程序的顺序相同

  可以概括为:

  **volatile类型的变量保证对所有线程的可见性**

  **volatile类型的变量禁止指令重排序优化**

#### 并发内存模型的实质

java 内存模型围绕着并发过程中如何处理原子性,可见性和顺序性这三个特征来设计的

##### 原子性

由 java 内存模型来直接保证原子性的操作包括 read,load,use,assign,store,write这6个动作,如果需要更大范围的控制,则需要使用 synchronized 关键字

##### 可见性

可见性是指一个线程修改了一个变量的值后，其他线程立即可以感知到这个值的修改。正如前面所说，volatile类型的变量在修改后会立即同步给主内存，在使用的时候会从主内存重新读取，是依赖主内存为中介来保证多线程下变量对其他线程的可见性的。
 除了volatile，synchronized和final也可以实现可见性。synchronized关键字是通过unlock之前必须把变量同步回主内存来实现的，final则是在初始化后就不会更改，所以只要在初始化过程中没有把this指针传递出去也能保证对其他线程的可见性。

##### 有序性

有序性从不同的角度来看是不同的。单纯单线程来看都是有序的，但到了多线程就会跟我们预想的不一样。可以这么说：如果在本线程内部观察，所有操作都是有序的；如果在一个线程中观察另一个线程，所有的操作都是无序的。前半句说的就是“线程内表现为串行的语义”，后半句值得是“指令重排序”现象和主内存与工作内存之间同步存在延迟的现象。
 保证有序性的关键字有volatile和synchronized，volatile禁止了指令重排序，而synchronized则由“一个变量在同一时刻只能被一个线程对其进行lock操作”来保证。

#### 先行发生原则

java 语言中有一个"先行发生原则",是判断数据是否存在竞争,线程是否安全的主要依据

##### 什么是先行发生原则

先行发生原则是Java内存模型中定义的两个操作之间的偏序关系。比如说操作A先行发生于操作B，那么在B操作发生之前，A操作产生的“影响”都会被操作B感知到。这里的影响是指修改了内存中的共享变量、发送了消息、调用了方法等。个人觉得更直白一些就是有可能对操作B的结果有影响的都会被B感知到，对B操作的结果没有影响的是否感知到没有太大关系。

##### java 内存模型自带先行发生原则有哪些

- 程序次序原则
   在一个线程内部,按照代码的顺序,书写在前面的先行发生与后边的。或者更准确的说是在控制流顺序前面的先行发生与控制流后面的,而不是代码顺序,因为会有分支、跳转、循环等。

- 管程锁定规则
   一个unlock操作先行发生于后面对同一个锁的lock操作。这里必须注意的是对同一个锁，后面是指时间上的后面

- volatile变量规则
   对一个volatile变量的写操作先行发生与后面对这个变量的读操作,这里的后面是指时间上的先后顺序

- 线程启动规则
   Thread 对象的 start() 方法先行发生与该线程的每个动作。当然如果你错误的使用了线程,创建线程后没有执行start方法,而是执行 run 方法，那此句话是不成立的，但是如果这样其实也不是线程了

- 线程终止规则
   线程中的所有操作都先行发生与对此线程的终止检测,可以通过 Thread.join() 和 Thread.isAlive() 的返回值等手段检测线程是否已经终止执行

- 线程中断规则
   对线程 interrupt() 方法的调用先行发生于被中断线程的代码检测到中断事件的发生,可以通过 Thread.interrupted() 方法检测到是否有中断发生。

- 对象终结规则
   一个对象的初始化完成先行发生于他的 finalize 方法的执行,也就是初始化方法先行发生于 finalize 方法

- 传递性
   如果操作 A 先行发生于操作 B，操作 B 先行发生于操作 C，那么操作 A 先行发生于操作 C



---

来源:《深入理解Java虚拟机》